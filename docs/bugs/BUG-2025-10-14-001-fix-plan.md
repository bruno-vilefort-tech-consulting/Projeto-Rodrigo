# Fix Plan: BUG-2025-10-14-001

## Solu√ß√£o Escolhida

**Op√ß√£o 1: Condicionar o Bot√£o pela Feature Flag**

Mostrar o bot√£o "Adicionar Colunas" apenas quando `FEATURES.KANBAN_V2` est√° habilitada.

## Arquivos a Modificar

### 1. frontend/src/pages/Kanban/index.js

**Linha 297-305:** Modificar o bot√£o "Adicionar Colunas"

**Antes:**
```javascript
<Can role={user.profile} perform="dashboard:view" yes={() => (
  <Button
    variant="contained"
    color="primary"
    onClick={handleAddConnectionClick}
  >
    {i18n.t("kanban.addColumns")}
  </Button>
)} />
```

**Depois:**
```javascript
{FEATURES.KANBAN_V2 && (
  <Can role={user.profile} perform="dashboard:view" yes={() => (
    <Button
      variant="contained"
      color="primary"
      onClick={handleAddConnectionClick}
    >
      {i18n.t("kanban.addColumns")}
    </Button>
  )} />
)}
```

**Imports necess√°rios:**
Adicionar import da feature flag no topo do arquivo (ap√≥s linha 11):
```javascript
import { FEATURES } from "../../config/featureFlags";
```

## Mudan√ßas de API/Contratos

- Nenhuma mudan√ßa de API
- Nenhuma mudan√ßa de contratos
- Nenhum breaking change

## Migrations de Banco

- N√£o aplic√°vel

## Backward Compatibility

‚úÖ 100% backward compatible
- Se `KANBAN_V2 = false`: bot√£o n√£o aparece (comportamento seguro)
- Se `KANBAN_V2 = true`: bot√£o aparece e funciona normalmente
- Usu√°rios existentes n√£o s√£o afetados negativamente

## Rollback Plan

### Como fazer rollback:
```bash
git revert <commit-hash>
# OU
git reset --hard <commit-anterior>
```

### Impactos do rollback:
- Bot√£o volta a aparecer sempre
- Usu√°rios voltam a ver erro de navega√ß√£o se feature flag estiver desabilitada

### Tempo estimado: 2 minutos

## Testes de Regress√£o

### 1. Teste: Bot√£o vis√≠vel quando KANBAN_V2 = true
```javascript
// Configurar: REACT_APP_FEATURE_KANBAN_V2=true
// Acessar: /kanban
// Verificar: Bot√£o "Adicionar Colunas" est√° vis√≠vel
// Clicar: Bot√£o navega para /tagsKanban com sucesso
```

### 2. Teste: Bot√£o oculto quando KANBAN_V2 = false
```javascript
// Configurar: REACT_APP_FEATURE_KANBAN_V2=false ou undefined
// Acessar: /kanban
// Verificar: Bot√£o "Adicionar Colunas" N√ÉO est√° vis√≠vel
```

### 3. Teste: RBAC continua funcionando
```javascript
// Configurar: KANBAN_V2=true + usu√°rio sem permiss√£o "dashboard:view"
// Acessar: /kanban
// Verificar: Bot√£o N√ÉO est√° vis√≠vel (devido RBAC)
```

### 4. Teste: Outras funcionalidades intactas
```javascript
// Verificar: Filtros de data funcionam
// Verificar: Cards de tickets aparecem
// Verificar: Drag-and-drop funciona
// Verificar: Socket.IO real-time updates funcionam
```

## Checklist de Implementa√ß√£o

- [ ] Adicionar import de `FEATURES` em Kanban/index.js
- [ ] Envolver bot√£o "Adicionar Colunas" com condicional `{FEATURES.KANBAN_V2 && ...}`
- [ ] Verificar que a indenta√ß√£o est√° correta
- [ ] Rodar ESLint/Prettier
- [ ] Testar manualmente com KANBAN_V2=true
- [ ] Testar manualmente com KANBAN_V2=false
- [ ] Verificar que RBAC ainda funciona
- [ ] Criar commit com mensagem adequada

## Estimativa de Tempo

- Implementa√ß√£o: 5 minutos
- Testes manuais: 10 minutos
- Total: 15 minutos

## Riscos

üü¢ **BAIXO RISCO**
- Mudan√ßa cir√∫rgica (apenas 1 arquivo, 3 linhas)
- N√£o afeta l√≥gica existente
- N√£o afeta dados
- N√£o afeta multi-tenant
- Backward compatible

## Observa√ß√µes

- Esta corre√ß√£o garante consist√™ncia entre UI e roteamento
- Usu√°rios n√£o ver√£o bot√µes que levam a p√°ginas inexistentes
- A feature flag controla tanto a rota quanto o bot√£o
